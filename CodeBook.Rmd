---
title: "CodeBook"
author: "Cerys Williams"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Install Packages 

Installed tidyverse which includes dplyr, readr and lubridate as well as other useful packages nd markdowm to create the codebook 

```{r insatll packages}
library(tidyverse)
library(rmarkdown)
```

## Download data

Generated a unique file path to a temporary directory to avoid cluttering working dorectory. 

```{r generate path}
url <- "https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
destfile <- tempfile(fileext = ".zip")
```

Downloaded the HAR dataset ZIP file and saved it as "UCI_HAR_Dataset.zip" locally.
Unzipped it into a folder called "UCI_HAR_Dataset"


```{r download files}
download.file(url, destfile, mode = "wb")
unzip(destfile, exdir = "UCI_HAR_Dataset")
```


Created a list of the the files as avisual check. 

```{r list downloaded files}
list.files("UCI_HAR_Dataset", recursive = TRUE)
```

## Upload data into R 

Loaded  the metadata to label the variables in the data tables. 

```{r upload metadata}
features <- read.table("UCI_HAR_Dataset/UCI HAR Dataset/features.txt", col.names = c("index", "feature"))
activities <- read.table("UCI_HAR_Dataset/UCI HAR Dataset/activity_labels.txt", col.names = c("code", "activity"))
```

Uploaded both training and test data 

```{r training data}
x_train <- read.table("UCI_HAR_Dataset/UCI HAR Dataset/train/X_train.txt", col.names = features$feature)
y_train <- read.table("UCI_HAR_Dataset/UCI HAR Dataset/train/y_train.txt", col.names = "activity_code")
subject_train <- read.table("UCI_HAR_Dataset/UCI HAR Dataset/train/subject_train.txt", col.names = "subject")

```

```{r test data}
x_test <- read.table("UCI_HAR_Dataset/UCI HAR Dataset/test/X_test.txt", col.names = features$feature)
y_test <- read.table("UCI_HAR_Dataset/UCI HAR Dataset/test/y_test.txt", col.names = "activity_code")
subject_test <- read.table("UCI_HAR_Dataset/UCI HAR Dataset/test/subject_test.txt", col.names = "subject")
```

## Pre-merge cleaning:  

Checked column names to ensure  names are valid R column names (e.g., no duplicates or illegal characters).

```{r checked column names}
make.names(features$feature, unique = TRUE)
```

Confirmed row counts to ensure they will bind. 
```{r row count check}
stopifnot(nrow(x_train) == nrow(y_train), nrow(y_train) == nrow(subject_train))
```

## Merged the training and the test sets to create one data set

First combined the  train and test sets
```{r combine train and test data sets}
x_all <- rbind(x_train, x_test)
y_all <- rbind(y_train, y_test)
subject_all <- rbind(subject_train, subject_test)
```

Then merged  the three resulting data frames into one data set.

```{r merge reulting data frames}
data_all <- cbind(subject_all, y_all, x_all)
```

## Name the activities in the data set

Used the  descriptive activity names in the meta data  to name the activities in the data set
```{r name activities}
data_all$activity <- factor(data_all$activity_code, levels = activities$code, labels = activities$activity)
```

Then fixed column names, as some feature names contained parentheses, dashes, or commas. 


```{r fix column names}
names(data_all) <- make.names(names(data_all), unique = TRUE)
```

checked the Column Names


```{r column name check}
colnames(data_all)
```
 Noted that activity is difficult to locate in the dataset as it is the final variable  so moved `activity` up to be the third column (after `subject` and `activity_code`) to make it easier to read.


```{r relocate activity variable}
data_all <- data_all %>%
  relocate(activity, .after = activity_code)
```

Changed the activity names to lower case also to make it easier for everyone to read.  


```{r tolower activity names}
data_all$activity <- tolower(data_all$activity)
```

## Extracted only the measurements on the mean and standard deviation for each measurement. 

Used matches()  to grab any column names that contain "mean" or "std" (standard deviation) which aligned with the original feature naming convention from features.txt.


```{r extracted mean and sd}
tidy_data <- data_all %>%
  select(subject, activity, matches("mean\\.|std\\."))
```

## Created a second, independent tidy data set with the average of each variable for each activity and each subject

Used group_by() function to group the data by each subject and each activity 
Used summarise(across(everything(), mean) to calculate the average of each variable (i.e., each sensor feature) within those groups. )
Used groups = "drop" to ungroup the result, giving a clean, independent dataset. 

```{r create second data set with averages}
summary_data <- tidy_data %>%
  group_by(subject, activity) %>%
  summarise(across(everything(), mean), .groups = "drop")
```

## Saved the new data sets in the  project folder

```{r saved data sets}
write.table(tidy_data, file = "tidy_data.txt", row.names = FALSE)
write.table(summary_data, file = "summary_data.txt", row.names = FALSE)
```



